<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="admin_user">
 
	<select id="selectAU" resultClass="adminUser"
		parameterMap="parameterMap_au">
		<![CDATA[
	   	SELECT
    		  adminid,
    		  realname,
    		  pwd, 
    		  pwdsettime, 
    		  locked, 
    		  temploginerrcnt, 
    		  longloginerrcnt, 
    		  loginlocktime,
    		  logintime,
    		  logincnt, 
    		  createuser, 
    		  enabled,
    		  email,
    		  address,
    		  tel,
    		  cellphone,
    		  createtime,
    		  descp
            FROM otppms_admininfo WHERE 1=1 
         ]]>
		<include refid="queryAdUserCondition" />
		<![CDATA[
			order by adminid asc  LIMIT #pageSize#
            OFFSET #startRow#
		]]>
	</select>
	
		<!-- filter super admin -->
		<select id="selectAUExceptPowerAdmin" resultClass="adminUser"
		parameterMap="parameterMap_au">
		<![CDATA[
	   	SELECT
    		  adminid,
    		  realname,
    		  pwd, 
    		  pwdsettime, 
    		  locked, 
    		  temploginerrcnt, 
    		  longloginerrcnt, 
    		  loginlocktime,
    		  logintime,
    		  logincnt, 
    		  createuser, 
    		  enabled,
    		  email,
    		  address,
    		  tel,
    		  cellphone,
    		  createtime,
    		  descp
            FROM otppms_admininfo WHERE 1=1  and  adminid !=(select adminid from otppms_admin_role ft_ar , otppms_roleinfo ft_r where ft_ar.roleid=ft_r.roleid and ft_r.rolemark='ADMIN')
         ]]>
		<dynamic prepend="">
 			<isNotNull property="adminid" prepend="and">
				<isNotEmpty property="adminid">
					adminid like '%$adminid$%'
				</isNotEmpty>
			</isNotNull>
			<isNotNull property="realname" prepend="and">
				<isNotEmpty property="realname">
					realname like '%$realname$%'
				</isNotEmpty>
			</isNotNull>
		</dynamic>	
		<![CDATA[
			order by createtime asc  LIMIT #pageSize#
            OFFSET #startRow#
		]]>
	</select>
	
	<select id="selectSelfChildOU" resultClass="adminUser"
		parameterMap="parameterMap_au">
		<![CDATA[
	   	SELECT
    		  adminid,
    		  realname,
    		  pwd, 
    		  pwdsettime, 
    		  locked, 
    		  temploginerrcnt, 
    		  longloginerrcnt, 
    		  loginlocktime,
    		  logintime,
    		  logincnt, 
    		  createuser, 
    		  enabled,
    		  email,
    		  address,
    		  tel,
    		  cellphone,
    		  createtime,
    		  descp
       from(SELECT * FROM otppms_admininfo WHERE 1=1
         ]]>
		<dynamic prepend="">
			<isNotNull property="loginUser" prepend="and">
				<isNotEmpty property="loginUser">
					createuser =#loginUser# union all select * FROM
					otppms_admininfo where adminid = #loginUser#)
					otppms_admininfo where 1=1
				</isNotEmpty>
			</isNotNull>
		</dynamic>
		<include refid="queryAdUserCondition" />
		<![CDATA[
			order by createtime asc  LIMIT #pageSize#
            OFFSET #startRow#
		]]>
	</select>
	 
</sqlMap>
 