<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="token_info">
	<select id="selectTK" resultMap="resultMap_tk"
		parameterMap="parameterMap_tk">
		<![CDATA[
		    SELECT
	    		tn.token,
	    		tn.enabled,
	    		tn.locked,
	    		tn.lost,
	    		tn.logout,	    	
	    		tn.authnum,
	    		tn.authmethod,
	    		tn.empin  ,
	    		tn.empindeath ,
	    		tn.expiretime,
	    		tn.syncwnd,
	    		tn.temploginerrcnt,  
	    		tn.longloginerrcnt,  
	    		tn.loginlocktime,
	    		tn.driftcount,
	    		tn.physicaltype,
	    		tn.producttype,
	    		tn.specid,
	    		tn.domainid,
	    		tn.orgunitid,
	    		tn.gensmstime,
	    		tn.importtime,
	    		tn.distributetime,
	    		tn.crauthnum  ,
				tn.authtime , 
				tn.crauthtime  ,
				tn.authotp  ,
				tn.crauthotp ,
				tn.crauthdata  ,
				tn.cractivecode  ,
				tn.pubkeystate  ,
				tn.newpubkey  ,
				tn.cractivetime  ,
				tn.cractivecount, 
				tn.vendorid,
	    		CASE (select count(bindid) from otppms_user_token where otppms_user_token.token =tn.token)
	    		WHEN 0  THEN 0
	    				ELSE 1 
	    		END   
	    		AS bindTag  
           from otppms_tokeninfo tn      where 1=1
            ]]>
		 <include refid="queryTokensCondition" /> 
		 <![CDATA[       		
        	order by tn.token asc
            LIMIT #pageSize#
            OFFSET #startRow#
        ]]>
	</select>
	
	<!-- special filter -->
	<select id="selectTKBC" resultMap="resultMap_tk"
		parameterMap="parameterMap_tk">
		<![CDATA[
		    SELECT
	    		tn.token,
	    		tn.enabled,
	    		tn.locked,
	    		tn.lost,
	    		tn.logout,
	    		
	    		tn.authnum,
	    		tn.authmethod,
	    		tn.empin  ,
	    		tn.empindeath ,
	    		tn.expiretime,
	    		tn.syncwnd,
	    		tn.temploginerrcnt,  
	    		tn.longloginerrcnt,  
	    		tn.loginlocktime,
	    		tn.driftcount,
	    		tn.physicaltype,
	    		tn.producttype,
	    		tn.specid,
	    		tn.domainid,
	    		tn.orgunitid,
	    		tn.gensmstime,
	    		tn.importtime,
				tn.distributetime,
	    		tn.crauthnum  ,
				tn.authtime , 
				tn.crauthtime  ,
				tn.authotp  ,
				tn.crauthotp ,
				tn.crauthdata  ,
				tn.cractivecode  ,
				tn.pubkeystate  ,
				tn.newpubkey  ,
				tn.cractivetime  ,
				tn.cractivecount, 
				tn.vendorid,
	    		CASE (select count(bindid) from otppms_user_token where otppms_user_token.token =tn.token)
	    		when 0  then 0
	    				else 1 
	    		end   
	    		as bindTag 
           from otppms_tokeninfo tn     where 1=1
            ]]>
		 <include refid="queryTokensConditionBC" /> 
		 <![CDATA[       		
        	order by tn.token asc
          ]]>
          <dynamic prepend="">
			<isNotNull property="upPageTag">
				<isNotEmpty property="upPageTag">
					<isEqual compareValue="1" property="upPageTag"><!-- 1 page, 0 not page -->
						LIMIT #pageSize#
            			OFFSET #startRow#
            		</isEqual>
				</isNotEmpty>
			</isNotNull>			
		</dynamic>	        
	</select>
	
	<!-- change token -->
	<select id="selectCT" resultMap="resultMap_tk"
		parameterMap="parameterMap_tk">
		<![CDATA[
		    SELECT
	    		tn.token,
	    		tn.enabled,
	    		tn.locked,
	    		tn.lost,
	    		tn.logout,
	    		tn.authnum,
	    		tn.authmethod,
	    		tn.empin  ,
	    		tn.empindeath ,
	    		tn.expiretime,
	    		tn.syncwnd,
	    		tn.temploginerrcnt,  
	    		tn.longloginerrcnt,  
	    		tn.loginlocktime,
	    		tn.driftcount,
	    		tn.physicaltype,
	    		tn.producttype,
	    		tn.specid,
	    		tn.domainid,
	    		tn.orgunitid,
	    		tn.gensmstime,
	    		tn.importtime,
				tn.distributetime,
	    		tn.crauthnum  ,
				tn.authtime , 
				tn.crauthtime  ,
				tn.authotp  ,
				tn.crauthotp ,
				tn.crauthdata  ,
				tn.cractivecode  ,
				tn.pubkeystate  ,
				tn.newpubkey  ,
				tn.cractivetime  ,
				tn.cractivecount, 
				tn.vendorid,
	    		CASE (select count(bindid) from otppms_user_token where otppms_user_token.token =tn.token)
	    		when 0  then 0
	    				else 1 
	    		end   
	    		as bindTag 
           from otppms_tokeninfo tn     where 1=1
            ]]>
		 <include refid="queryTokensConditionCT" /> 
		 <![CDATA[       		
        	order by tn.token asc
          ]]>
          <dynamic prepend="">
			<isNotNull property="upPageTag">
				<isNotEmpty property="upPageTag">
					<isEqual compareValue="1" property="upPageTag">
						LIMIT #pageSize#
            			OFFSET #startRow#
            		</isEqual>
				</isNotEmpty>
			</isNotNull>			
		</dynamic>	        
	</select>
 </sqlMap>
