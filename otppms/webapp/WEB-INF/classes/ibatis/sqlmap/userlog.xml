<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="user_log">
 <typeAlias alias="userlogInfo" type="com.ft.otp.manager.logs.userlog.entity.UserLogInfo"/>

	<parameterMap class="userlogInfo" id="parameterMap_aul">
		<parameter property="id" javaType="int" jdbcType="INTEGER" />
		<parameter property="userid" javaType="string" jdbcType="VARCHAR" />
		<parameter property="token" javaType="string" jdbcType="VARCHAR" />
		<parameter property="clientip" javaType="string" jdbcType="VARCHAR" />
		<parameter property="actionid" javaType="int" jdbcType="INTEGER" />
		<parameter property="actionresult" javaType="int" jdbcType="INTEGER" />
		<parameter property="logtime" javaType="int" jdbcType="INTEGER" />
		<parameter property="logcontent" javaType="string" jdbcType="VARCHAR" />
		<parameter property="hashcode" javaType="string" jdbcType="VARCHAR" />
		<parameter property="domainid" javaType="int" jdbcType="INTEGER" />
		<parameter property="domainname" javaType="string" jdbcType="VARCHAR" />
		<parameter property="orgunitid" javaType="int" jdbcType="INTEGER" />
		<parameter property="orgunitname" javaType="string" jdbcType="VARCHAR" />
		<parameter property="moduletype" javaType="int" jdbcType="INTEGER" />
		<parameter property="vendorid" javaType="string" jdbcType="VARCHAR" />
		<parameter property="startLogTime" javaType="int" />
		<parameter property="endLogTime" javaType="int" />

		<parameter property="pageSize" javaType="int" jdbcType="INTEGER" />
		<parameter property="startRow" javaType="int" jdbcType="INTEGER" />
	</parameterMap>
	
	<sql id="queryUserLogCondition">
		<dynamic prepend="">
    	  <isNotNull>
    	     <isNotEmpty property="userid" prepend="and">
    	         userid like '%$userid$%'
    	     </isNotEmpty>
    	  </isNotNull>
    	  <isNotNull>
    	     <isNotEmpty property="token" prepend="and">
    	         token like '%$token$%'
    	     </isNotEmpty>
    	  </isNotNull>
    	  <isGreaterThan compareValue="0" property="startDate"
				prepend="and">
				<![CDATA[ logtime >= #startDate# ]]>
		  </isGreaterThan>
		  <isGreaterThan compareValue="0" property="endDate"
				prepend="and">
				<![CDATA[ logtime <= #endDate# ]]>
		  </isGreaterThan>
		  <isNotNull property="clientip">
				<isNotEmpty property="clientip" prepend="and">
					clientip like '%$clientip$%'
				</isNotEmpty>
			</isNotNull>
			<isNotNull property="actionresult">
				<isNotEmpty property="actionresult" >
					<isGreaterThan compareValue="-1" property="actionresult" prepend="and">
							actionresult = #actionresult#
					</isGreaterThan>
				</isNotEmpty>
			</isNotNull>
		  <isNotNull property="batchIds" prepend="and">
				userid in
				<iterate property="batchIds" open="(" close=")"
					conjunction=",">
					#batchIds[]#
				</iterate>
			</isNotNull>
    	</dynamic>   
	</sql>
	<select id="countUL" resultClass="int" parameterClass="userlogInfo">
		<![CDATA[
    		select count(id) from otppms_loginfo where 1=1
    	]]>
    	<include refid="queryUserLogCondition" />
	</select>
	
	<select id="findUL" parameterMap="parameterMap_aul"
		resultClass="userlogInfo">
		<![CDATA[
	   	select id,userid,token,clientip,actionid,actionresult,logtime,
    		logcontent,hashcode,domainid,domainname,orgunitid,orgunitname,moduletype,vendorid,serverip
    		from otppms_loginfo  where 1=1
		]]>
		<dynamic prepend="">
			<isNotNull property="id" >
				<isNotEqual property="id" prepend="and" compareValue="0">
					id = #id#
				</isNotEqual>
			</isNotNull>
		</dynamic>
	</select>
	
	<!-- delete log -->
	<delete id="deleleLog" parameterClass="userlogInfo">
		<![CDATA[
			DELETE FROM otppms_loginfo where 1=1
		]]>
		<dynamic prepend="">
			<isNotEmpty property="logtime" prepend="and">
    	          <![CDATA[ logtime <=#logtime#]]> 
    	    </isNotEmpty>  
		</dynamic>   
	</delete>
	 
</sqlMap>	