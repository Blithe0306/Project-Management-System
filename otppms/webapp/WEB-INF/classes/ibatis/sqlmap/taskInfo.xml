<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="task_info">
	  <typeAlias alias="taskInfo"
		type="com.ft.otp.manager.task.entity.TaskInfo" />
	<parameterMap class="taskInfo" id="parameterMap_tg">
	    <parameter property="sourceid" javaType="int"  	  jdbcType="INTEGER" />
		<parameter property="taskname" javaType="string"    jdbcType="VARCHAR" />
		<parameter property="sourcetype" javaType="int"      jdbcType="INTEGER" />
		<parameter property="taskmode1" javaType="int"   jdbcType="INTEGER" />
		<parameter property="taskmode2" javaType="int"   jdbcType="INTEGER" />
		<parameter property="taskminute" javaType="string" jdbcType="VARCHAR" />
		<parameter property="taskhour" javaType="string"   jdbcType="VARCHAR" />
		<parameter property="taskday" javaType="string"    jdbcType="VARCHAR" />
		<parameter property="taskweek" javaType="string"   jdbcType="VARCHAR" />
		<parameter property="taskmonth" javaType="string"  jdbcType="VARCHAR" />
		<parameter property="enabled" javaType="int"  jdbcType="INTEGER" />
		<parameter property="taskid" javaType="string"    jdbcType="VARCHAR" />
		<parameter property="descp" javaType="string"    jdbcType="VARCHAR" />
		
		<parameter property="mdayStr" javaType="string"       jdbcType="VARCHAR" />
		<parameter property="mhourStr" javaType="string"      jdbcType="VARCHAR" />
		<parameter property="whourStr" javaType="string"      jdbcType="VARCHAR" />
		<parameter property="wweekStr" javaType="string"      jdbcType="VARCHAR" />
		<parameter property="selAccMinute" javaType="string"  jdbcType="VARCHAR" />
		<parameter property="selAccHour" javaType="string"    jdbcType="VARCHAR" />
	</parameterMap>
    
    <sql id="queryCondition">
		<dynamic>
			<isNotNull property="taskname" prepend="and">
				<isNotEmpty property="taskname">
					taskname = #taskname#
				</isNotEmpty>
			</isNotNull>
			<isNotNull property="sourceid" >
				<isNotEqual property="sourceid"  compareValue="0" prepend="and">
					sourceid = #sourceid#
				</isNotEqual>
			</isNotNull>
			<isNotNull property="sourcetype" >
				<isNotEqual property="sourcetype" compareValue="0" prepend="and">
					sourcetype = #sourcetype#
				</isNotEqual>
			</isNotNull>
		</dynamic>
	</sql>
    
    <select id="queryTG" parameterMap="parameterMap_tg"
		resultClass="taskInfo">
		<![CDATA[
	 		SELECT
				tg.sourceid,
	    		tg.taskname,
				tg.sourcetype,
				tg.taskmode1,
				tg.taskmode1,
	    	    tg.taskminute,
	    	    tg.taskday,
	    	    tg.taskhour,
	    	    tg.taskweek,
	    	    tg.taskmonth,
	    	    tg.taskid,
	    	    tg.enabled,
	    	    tg.descp
       		from otppms_taskinfo tg  WHERE 1=1
         ]]>
		<dynamic prepend="">
			<isNotNull>
				<isNotEqual compareValue="-1" property="enabled" prepend="and">
		           enabled = #enabled#
		       </isNotEqual> 
			</isNotNull>
			<isNotNull property="sourcetype" >
				<isNotEqual property="sourcetype" compareValue="-1" prepend="and">
					sourcetype = #sourcetype#
				</isNotEqual>
			</isNotNull>
			<isNotNull property="batchIdsInt" prepend="and">
				sourceid IN
				<iterate property="batchIdsInt" open="(" close=")"
					conjunction=",">
					#batchIdsInt[]#
				</iterate>
			</isNotNull>
		</dynamic>
	</select>
	
	<select id="findTG" parameterClass="taskInfo"
		resultClass="taskInfo">
		<![CDATA[
			SELECT
				sourceid,
    			taskname,
				sourcetype,
				taskmode1,
				taskmode2,
    	    	taskminute,
    	    	taskday,
    	    	taskhour,
    	    	taskweek,
    	    	taskmonth,
    	    	taskid,
    	    	enabled,
    	    	descp
       		from otppms_taskinfo WHERE 1=1
         ]]>
		<include refid="queryCondition" />
	</select>

	<insert id="insertTG" parameterClass="taskInfo">
		insert into
		otppms_taskinfo(sourceid,taskname,sourcetype,taskmode1,taskmode2,taskminute,taskday,taskhour,taskweek,taskmonth,enabled,taskid,descp)
		values(#sourceid#,#taskname#,#sourcetype#,#taskmode1#,#taskmode2#,#taskminute#,#taskday#,#taskhour#,#taskweek#,#taskmonth#,#enabled#,#taskid#,#descp#)
	</insert>

	<update id="updateTG" parameterClass="taskInfo">
		update otppms_taskinfo set   taskmode1=#taskmode1#,
									taskmode2=#taskmode2#,
									taskminute=#taskminute#,
									taskhour=#taskhour#,
									taskday=#taskday#,
									taskweek=#taskweek#,
									taskmonth=#taskmonth#,
									enabled = #enabled#,
								    taskid = #taskid#,
								    descp = #descp#
		 where 1=1
		 <include refid="queryCondition" />
	</update>
	
	<update id="updateTGState" parameterClass="taskInfo">
		  update otppms_taskinfo set enabled = #enabled# where 1=1
		  <include refid="queryCondition" />
	</update>
	
	<delete id="deleteTG" parameterClass="taskInfo">
	     delete from otppms_taskinfo where 1=1
		 <dynamic prepend="">
			<isNotNull property="batchIdsInt" prepend="and">
				sourceid IN
				<iterate property="batchIdsInt" open="(" close=")"
					conjunction=",">
					#batchIdsInt[]#
				</iterate>
			</isNotNull>
		</dynamic>
    </delete>
	 
</sqlMap>
