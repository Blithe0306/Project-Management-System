<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="admin_log">
	<typeAlias alias="adminlogInfo"
		type="com.ft.otp.manager.logs.adminlog.entity.AdminLogInfo" />

	<parameterMap class="adminlogInfo" id="parameterMap_al">
		<parameter property="id" javaType="int" jdbcType="INTEGER" />
		<parameter property="operator" javaType="string" jdbcType="VARCHAR" />
		<parameter property="actionid" javaType="int" jdbcType="INTEGER" />
		<parameter property="actionresult" javaType="int" jdbcType="INTEGER" />
		<parameter property="clientip" javaType="string" jdbcType="VARCHAR" />
		<parameter property="descp" javaType="string" jdbcType="VARCHAR" />
		<parameter property="hashcode" javaType="string" jdbcType="VARCHAR" />
		<parameter property="logtime" javaType="int" jdbcType="INTEGER" />
		<parameter property="startLogTime" javaType="int" jdbcType="INTEGER" />
		<parameter property="endLogTime" javaType="int" jdbcType="INTEGER" />
		<parameter property="queryMark" javaType="int" jdbcType="Integer" />
		<parameter property="lidArr" javaType="int" jdbcType="Integer" />
		<parameter property="lobjArr" javaType="int" jdbcType="Integer" />

		<parameter property="pageSize" javaType="int" jdbcType="INTEGER" />
		<parameter property="startRow" javaType="int" jdbcType="INTEGER" />
	</parameterMap>

	<resultMap id="resultMap_log" class="adminlogInfo">
		<result property="id" column="id" />
		<result property="operator" column="operator" nullValue="NO_ENTRY" />
		<result property="actionid" column="actionid" nullValue="-999999" />
		<result property="logtime" column="logtime" nullValue="-999999" />
		<result property="actionresult" column="actionresult" nullValue="-999999" />
		<result property="actionobject" column="actionobject" nullValue="-999999" />
		<result property="hashcode" column="hashcode" nullValue="NO_ENTRY" />
		<result property="descp" column="descp" nullValue="NO_ENTRY" />
		<result property="clientip" column="clientip" nullValue="" />
	</resultMap>
	
	<sql id="queryAdminLogCondition">
		<dynamic prepend="and">
			<isNotNull property="batchIds">
				operator in
				<iterate property="batchIds" open="(" close=")"
					conjunction=",">
					#batchIds[]#
				</iterate>
			</isNotNull>
		</dynamic>
		<dynamic prepend="">
			<isNotNull>
				<isNotEmpty property="operator">
					<isNotNull property="queryMark" prepend="and">
						operator like '%$operator$%'
					</isNotNull>
				</isNotEmpty>
			</isNotNull>
			
			<isGreaterThan compareValue="0" property="startLogTime"
				prepend="and">
				<![CDATA[ logtime >= #startLogTime# ]]>
			</isGreaterThan>
			<isGreaterThan compareValue="0" property="endLogTime"
				prepend="and">
				<![CDATA[ logtime <= #endLogTime# ]]>
			</isGreaterThan>
			<isNotNull property="clientip">
				<isNotEmpty property="clientip" prepend="and">
					clientip like '%$clientip$%'
				</isNotEmpty>
			</isNotNull>
			<isNotNull property="actionresult">
				<isNotEmpty property="actionresult" >
					<isGreaterThan compareValue="-1" property="actionresult" prepend="and">
							actionresult = #actionresult#
					</isGreaterThan>
				</isNotEmpty>
			</isNotNull>
			
			<isNotNull property="lidArr">
				<isNotNull property="lobjArr" prepend="and">
					actionid IN
					<iterate property="lidArr" open="(" close=")"
						conjunction=",">
						#lidArr[]#
					</iterate>
					or actionobject IN
					<iterate property="lobjArr" open="(" close=")"
						conjunction=",">
						#lobjArr[]#
					</iterate>
					<isNotEmpty property="descp" prepend="or">
							descp  like '%$descp$%'
					</isNotEmpty>
				</isNotNull>
				<isNull property="lobjArr" prepend="and">
					actionid IN
					<iterate property="lidArr" open="(" close=")"
						conjunction=",">
						#lidArr[]#
					</iterate>
					
					<isNotEmpty property="descp" prepend="or">
							descp  like '%$descp$%'
					</isNotEmpty>
				</isNull>
			</isNotNull>
			<isNull property="lidArr">
				<isNotNull property="lobjArr" prepend="and">
					actionobject IN
					<iterate property="lobjArr" open="(" close=")"
						conjunction=",">
						#lobjArr[]#
					</iterate>
					
					<isNotEmpty property="descp" prepend="or">
							descp  like '%$descp$%'
					</isNotEmpty>
				</isNotNull>
			</isNull>
			<isNull property="lidArr">
				<isNull property="lobjArr">
					<isNotEmpty property="descp" prepend="and">
							descp  like '%$descp$%'
					</isNotEmpty>
				</isNull>
			</isNull>
			
			
		</dynamic>
	</sql>

	<select id="countAL" resultClass="int" parameterMap="parameterMap_al">
		<![CDATA[
    		select count(id) from otppms_admin_log  where 1=1
    	]]>
		<include refid="queryAdminLogCondition" />
	</select>

	<insert id="insertAL" parameterClass="adminlogInfo">
		<![CDATA[
    		INSERT INTO otppms_admin_log(operator,logtime,actionid,actionresult,actionobject,clientip,descp,hashcode)
    		VALUES(#operator#,#logtime#,#actionid#,#actionresult#,#actionobject#,#clientip#,#descp#,#hashcode#)    	
    	]]>
	</insert>
	
	<select id="findAL" resultMap="resultMap_log"
		parameterClass="adminlogInfo">
		<![CDATA[
	   	SELECT
	    		id,operator,logtime,actionid,actionresult,actionobject,clientip,descp,hashcode
            FROM otppms_admin_log where 1=1
		]]>
		<dynamic prepend="">
			<isNotNull property="id" >
				<isNotEqual property="id" prepend="and" compareValue="0">
					id = #id#
				</isNotEqual>
			</isNotNull>
		</dynamic>
	</select>
	
	<!-- delete log -->
	<delete id="deleleLog" parameterClass="adminlogInfo">
		<![CDATA[
			DELETE FROM otppms_admin_log where 1=1
		]]>
		<dynamic prepend="">
			<isNotEmpty property="logtime" prepend="and">
				<![CDATA[ logtime <=#logtime#]]>
			</isNotEmpty>
		</dynamic>
	</delete>

</sqlMap>
