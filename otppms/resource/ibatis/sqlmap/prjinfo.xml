<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="prjinfo">
	<typeAlias alias="prjinfo"
		type="com.ft.otp.manager.prjinfo.entity.Prjinfo" />
		
	<parameterMap class="prjinfo" id="parameterMap_ui">
		<parameter property="prjdesc" javaType="string" jdbcType="VARCHAR" />
		<parameter property="type" javaType="string" jdbcType="VARCHAR" />
		<parameter property="prjid" javaType="string" jdbcType="VARCHAR" />
		<parameter property="prjname" javaType="string" jdbcType="VARCHAR" />
		<parameter property="startTime" javaType="int" jdbcType="INTEGER" />
		<parameter property="endTime" javaType="int" jdbcType="INTEGER" />
		<parameter property="startRow" javaType="int"
			jdbcType="INTEGER" />
		<parameter property="pageSize" javaType="int"
			jdbcType="INTEGER" />
	</parameterMap>
	<resultMap id="resultMap_ui" class="prjinfo">
		<result property="id" column="id" nullValue="" />
		<result property="prjdesc" column="prjdesc" nullValue="" />
		<result property="type" column="type" nullValue="" />
		<result property="prjid" column="prjid" nullValue="" />
		<result property="prjname" column="prjname" nullValue="" />
		<result property="svn" column="svn" nullValue="" />
		<result property="bug" column="bug" nullValue="" />
		<result property="path" column="path" nullValue="" />
		<result property="content" column="content" nullValue="" />
		<result property="developer" column="developer" nullValue="" />
		<result property="tester" column="tester" nullValue="" />
		<result property="createtime" column="createtime" nullValue="" />
		<result property="operator" column="operator" nullValue="" />
		<result property="results" column="results" nullValue="" />
	</resultMap>
	
	<sql id="queryPrinfoConditionUC">
        <![CDATA[
	    	WHERE 1=1
	    ]]>
		<dynamic prepend="">			
			<isNotNull property="prjid" prepend="and">
				<isNotEmpty property="prjid">
					i.prjid like '%$prjid$%'
				</isNotEmpty>
			</isNotNull>
			<isNotNull>
				<isNotEmpty property="prjname" prepend="and">
					p.prjname like '%$prjname$%'
				</isNotEmpty>
			</isNotNull>
			<isNotNull>
				<isNotEmpty property="type" prepend="and">
					i.type like '%$type$%'
				</isNotEmpty>
			</isNotNull>
		</dynamic>
	</sql>

	<select id="countPrjinfoUI" resultClass="int" parameterClass="prjinfo">
		<![CDATA[
	    	select count(i.prjid) from otppms_prjinfo i where 1=1
	    ]]>
	    <dynamic prepend="">
			<isNotNull property="prjid" prepend="and">
				<isNotEmpty property="prjid">
					i.prjid = #prjid#
				</isNotEmpty>
			</isNotNull>
		</dynamic>
	</select>
	
	<select id="selectPrjinfo" resultClass="prjinfo" parameterClass="prjinfo">
		<![CDATA[
	    	 SELECT 
		       i.id,i.prjdesc,i.type,i.prjid,i.svn,i.bug,i.results,
		       i.path,i.content,i.developer,i.tester,i.createtime,i.operator,
		       p.prjname
		   from otppms_prjinfo i, otppms_project p 
		  where p.id = i.prjid and 1=1 
	    ]]>
	    <dynamic prepend="">
	    	<isGreaterThan compareValue="0" property="id" prepend="and">
					<![CDATA[ i.id = #id# ]]>
			</isGreaterThan>
			<isNotNull property="prjdesc" prepend="and">
				<isNotEmpty property="prjdesc">
					i.prjdesc like '%$prjdesc$%'
				</isNotEmpty>
			</isNotNull>
			<isNotNull property="prjname" prepend="and">
				<isNotEmpty property="prjname">
					p.prjname like '%$prjname$%'
				</isNotEmpty>
			</isNotNull>
			<isNotNull property="prjid" prepend="and">
				<isNotEmpty property="prjid">
					i.prjid = #prjid#
				</isNotEmpty>
			</isNotNull>
			<isGreaterThan compareValue="0" property="startTime" prepend="and">
					<![CDATA[ i.createtime >= #startTime# ]]>
			</isGreaterThan>
			<isGreaterThan compareValue="0" property="endTime" prepend="and">
					<![CDATA[ i.createtime <= #endTime# ]]>
			</isGreaterThan>
		</dynamic>
		<![CDATA[
	    	order by i.createtime desc 
	    ]]>
		<![CDATA[
			LIMIT #pageSize# OFFSET #startRow#
		]]>
	</select>

	<insert id="insertPrjinfoUI" parameterClass="prjinfo">
		<![CDATA[
    		INSERT INTO otppms_prjinfo(
    		prjdesc,type,prjid,svn,bug,path,content,developer,tester,createtime,operator,results
			)
    		VALUES(#prjdesc#,#type#,#prjid#,#svn#,#bug#,
    		#path#,#content#,#developer#,#tester#,#createtime#,#operator#,#results#)
    	]]>
	</insert>
    
    <!-- update prjinfo base info -->
    <update id="updatePrjinfoUI" parameterClass="prjinfo">
		<![CDATA[
			UPDATE otppms_prjinfo SET 
			prjid=#prjid#,
			prjdesc=#prjdesc#,
    		type=#type#,
    		svn=#svn#,
    		bug=#bug#,
    		path=#path#,
    		content=#content#,
    		developer=#developer#,
    		tester=#tester#,
    		results=#results#
			WHERE  1=1 
		]]>
		<isNotNull>
			<isNotEmpty property="id" prepend="and">
				id = #id#
			</isNotEmpty>
		</isNotNull>
	</update>
	
	<!-- delete prjinfo -->
	<delete id="deletePrjinfoUI" parameterClass="prjinfo">
		<![CDATA[
			DELETE FROM otppms_prjinfo WHERE 1=1 and id = #id#
		]]>
	</delete>
</sqlMap>
