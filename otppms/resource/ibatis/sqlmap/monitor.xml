<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="monitor_info">

	<typeAlias alias="monitorAndAdminInfo"
		type="com.ft.otp.manager.monitor.entity.MonitorAndAdminInfo" />
	<typeAlias alias="monitorInfo"
		type="com.ft.otp.manager.monitor.entity.MonitorInfo" />	
		
	<!-- relation table begin -->	
	<!-- query monitor type and admin relation common condition -->
 	<sql id="queryMonitorAndAdminCondition">
		<dynamic prepend="">
			<isNotNull property="adminid" prepend="and">
				<isNotEmpty property="adminid">
					adminid = #adminid#
				</isNotEmpty>
			</isNotNull>
			<isNotNull property="conftype" prepend="and">
				<isNotEmpty property="conftype">
					conftype = #conftype#
				</isNotEmpty>
			</isNotNull>
		</dynamic>
	</sql> 	
 	<!-- query monitor type and admin relation -->
 	<select id="queryMonitorAndAdminInfo" parameterClass="monitorAndAdminInfo"
		resultClass="monitorAndAdminInfo">
		<![CDATA[
	   	SELECT
    		  adminid,
    		  conftype
            FROM otppms_monitor_admin WHERE 1=1 
	 	]]>
	 	<include refid="queryMonitorAndAdminCondition" />  
	</select>
	<!-- add monitor type and admin relation -->
 	<insert id="addMonitorAndAdminInfo" parameterClass="monitorAndAdminInfo">
		<![CDATA[
	   	    insert into otppms_monitor_admin(adminid,conftype)
	   	    	values(#adminid#,#conftype#)
         ]]>
	</insert>
	
	<!-- update monitor type and admin relation -->
	<update id="upMonitorAndAdminInfo" parameterClass="monitorAndAdminInfo">
		<![CDATA[
	   	update otppms_monitor_admin set 
    		  adminid = #adminid#,
    		  conftype = #conftype#
           	 WHERE 1=1 
         ]]>
		<include refid="queryMonitorAndAdminCondition" />  
	</update>
	
	<!-- delete monitor type and admin relation -->
 	<delete id="delMonitorAndAdminInfo" parameterClass="monitorAndAdminInfo">
		<![CDATA[
	   	    delete from otppms_monitor_admin where 1=1
         ]]>
         <include refid="queryMonitorAndAdminCondition" />  
	</delete>
	<!--  relation table end -->	
 
 	<!-- monitor info table deal begin -->
 	<!-- query monitor info common condition -->
 	<sql id="queryMonitorCondition">
		<dynamic prepend="">
			<isNotEqual compareValue="0" property="id"> 
				<isNotNull property="id" prepend="and">
					id = #id#
				</isNotNull>
			</isNotEqual>
			<isNotEqual compareValue="0" property="confid"> 
				<isNotNull property="confid" prepend="and">
					<isNotEmpty property="confid">
						confid = #confid#
					</isNotEmpty>
				</isNotNull>
			</isNotEqual>
			<isNotNull property="conftype" prepend="and">
				<isNotEmpty property="conftype">
					conftype = #conftype#
				</isNotEmpty>
			</isNotNull>
			<isNotNull property="title" prepend="and">
				<isNotEmpty property="title">
					title = #title#
				</isNotEmpty>
			</isNotNull>
		</dynamic>	
	</sql> 
	
	<!-- query monitor info by condition -->
 	<select id="queryMonitorInfo" parameterClass="monitorInfo"
		resultClass="monitorInfo">
		<![CDATA[
	   	SELECT
	   		  id,
    		  email,
    		  mobile,
    		  confid,
    		  conftype,
    		  title, 
    		  content,     		  
    		  sendtime,
    		  issend 
            FROM otppms_monitorinfo WHERE 1=1 and issend = 0
         ]]>
		<include refid="queryMonitorCondition" />
	</select>
	
	<!-- query monitor info by condition -->
 	<select id="queryMonitorOkInfo" parameterClass="monitorInfo"
		resultClass="monitorInfo">
		<![CDATA[
	   	SELECT
	   		  id,
    		  email,
    		  mobile,
    		  confid,
    		  conftype,
    		  title, 
    		  content,     		  
    		  sendtime,
    		  issend 
            FROM otppms_monitorinfo WHERE 1=1
         ]]>
		<include refid="queryMonitorCondition" />
	</select>
	
	<!-- query max sendtime monitorinfo by monitor type  -->
 	<select id="queryMaxSendtimeMonitorInfo" parameterClass="monitorInfo"
		resultClass="monitorInfo">
		<![CDATA[
	   	SELECT
	   		  id,
    		  email,
    		  mobile,
    		  confid,
    		  conftype,
    		  title, 
    		  content,     		  
    		  sendtime,
    		  issend 
            FROM otppms_monitorinfo WHERE 1=1 and sendtime = 
             (SELECT MAX(sendtime) FROM otppms_monitorinfo where 1=1 ]]>
             <include refid="queryMonitorCondition" />    
         <![CDATA[ )
         ]]>
		<include refid="queryMonitorCondition" />  
	</select>
	
	<!-- update monitor info by condition -->
	<update id="updateMonitorInfo" parameterClass="monitorInfo">
		<![CDATA[
	   	update otppms_monitorinfo set 
	   		  email = #email#,
	   		  mobile = #mobile#,
    		  title = #title#,
    		  content = #content#,
    		  sendtime = #sendtime#,
    		  issend = #issend#
           	 WHERE 1=1 
         ]]>
		<include refid="queryMonitorCondition" /> 
	</update>
 	
 	<!-- add monitor info -->
 	<insert id="addMonitorInfo" parameterClass="monitorInfo">
		<![CDATA[
	   	    insert into otppms_monitorinfo(email,mobile,confid,conftype,title,content,sendtime,issend)
	   	    	values(#email#,#mobile#,#confid#,#conftype#,#title#,#content#,#sendtime#,#issend#)
         ]]>
	</insert>
	
	<!-- delete monitor info -->
 	<delete id="deleteMonitorInfo" parameterClass="monitorInfo">
		<![CDATA[
	   	    delete from otppms_monitorinfo where 1=1
         ]]>
         <include refid="queryMonitorCondition" />  
	</delete>
  	<!-- monitor info deal end -->
</sqlMap>
 